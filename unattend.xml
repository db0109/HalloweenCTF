<?xml version='1.0' encoding='utf-8'?>
<unattend xmlns="urn:schemas-microsoft-com:unattend" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State">

    <settings pass="windowsPE" wasPassProcessed="true">
        <component name="Microsoft-Windows-International-Core-WinPE" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
            <InputLocale>en-US</InputLocale>
            <SystemLocale>en-US</SystemLocale>
            <UserLocale>en-US</UserLocale>
            <!-- UILanguage must match the installation media language.  Stuff like de-CH does not work for
                 example de_windows_7_enterprise_with_sp1_x64_dvd_u_677649.iso.  However, stupidly we cannot
                 omit this element (kudos to brilliant minds at MS).  -->
            <UILanguage>en-US</UILanguage>
        </component>

        <component name="Microsoft-Windows-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">

            <DiskConfiguration>
                <WillShowUI>OnError</WillShowUI>
                <Disk>
                    <DiskID>0</DiskID>
                    <WillWipeDisk>true</WillWipeDisk>

                    <CreatePartitions>
                        <!-- TODO: Use the standard partitioning scheme at starting with Windows 8 maybe, using 2 partitions as described by Microsoft? -->
                        <CreatePartition>
                            <Order>1</Order>
                            <Type>Primary</Type>
                            <Extend>true</Extend>
                        </CreatePartition>
                    </CreatePartitions>


                </Disk>
            </DiskConfiguration>

            <UserData>
                <ProductKey>*SENSITIVE*DATA*DELETED*</ProductKey>
                <AcceptEula>true</AcceptEula>
            </UserData>

            <ImageInstall>
                <OSImage>
                    <InstallFrom>
                        <!-- TODO: This stuff doesn't work for en_windows_vista_enterprise_sp1_x64_and_x86.iso ... -->
                        <MetaData wcm:action="add">
                            <Key>/IMAGE/INDEX</Key>
                            <Value>1</Value>
                        </MetaData>
                        <!-- <Path>d:\sources\install.wim</Path> - the w7 tests doesn't specify this -->
                    </InstallFrom>
                    <InstallTo>
                        <DiskID>0</DiskID>

                        <PartitionID>1</PartitionID>


                    </InstallTo>
                    <WillShowUI>OnError</WillShowUI>
                    <InstallToAvailablePartition>false</InstallToAvailablePartition>
                </OSImage>
            </ImageInstall>

            <ComplianceCheck>
                <DisplayReport>OnError</DisplayReport>
            </ComplianceCheck>

            <!-- Apply registry tweaks to Windows PE, skipping the checks in the Windows 11 setup program. This will not make it to the final install, and should do no harm with older Windows versions. -->
            <RunAsynchronous>
                <RunAsynchronousCommand>
                    <Order>1</Order>
                    <Path>reg.exe ADD HKLM\SYSTEM\Setup\LabConfig /v BypassCPUCheck /t REG_DWORD /d 1 /f</Path>
                    <Description>Windows 11 disable CPU check</Description>
                </RunAsynchronousCommand>
                <RunAsynchronousCommand>
                    <Order>2</Order>
                    <Path>reg.exe ADD HKLM\SYSTEM\Setup\LabConfig /v BypassRAMCheck /t REG_DWORD /d 1 /f</Path>
                    <Description>Windows 11 disable RAM check</Description>
                </RunAsynchronousCommand>
                <RunAsynchronousCommand>
                    <Order>3</Order>
                    <Path>reg.exe ADD HKLM\SYSTEM\Setup\LabConfig /v BypassSecureBootCheck /t REG_DWORD /d 1 /f</Path>
                    <Description>Windows 11 disable Secure Boot check</Description>
                </RunAsynchronousCommand>
                <RunAsynchronousCommand>
                    <Order>4</Order>
                    <Path>reg.exe ADD HKLM\SYSTEM\Setup\LabConfig /v BypassStorageCheck /t REG_DWORD /d 1 /f</Path>
                    <Description>Windows 11 disable Storage check</Description>
                </RunAsynchronousCommand>
                <RunAsynchronousCommand>
                    <Order>5</Order>
                    <Path>reg.exe ADD HKLM\SYSTEM\Setup\LabConfig /v BypassTPMCheck /t REG_DWORD /d 1 /f</Path>
                    <Description>Windows 11 disable TPM check</Description>
                </RunAsynchronousCommand>
            </RunAsynchronous>

        </component>
    </settings>

    <settings pass="specialize" wasPassProcessed="true">
        <component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
            <ComputerName>PC1</ComputerName>
        </component>

        <component name="Microsoft-Windows-Deployment" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">

            <!-- Apply registry tweaks in the final Windows install, skipping the checks in the Windows 11 setup program. This means upgrades started in this install will work without compatibility complaints. -->
            <RunAsynchronous>
                <RunAsynchronousCommand>
                    <Order>1</Order>
                    <Path>reg.exe ADD HKLM\SYSTEM\Setup\LabConfig /v BypassCPUCheck /t REG_DWORD /d 1 /f</Path>
                    <Description>Windows 11 disable CPU check</Description>
                </RunAsynchronousCommand>
                <RunAsynchronousCommand>
                    <Order>2</Order>
                    <Path>reg.exe ADD HKLM\SYSTEM\Setup\LabConfig /v BypassRAMCheck /t REG_DWORD /d 1 /f</Path>
                    <Description>Windows 11 disable RAM check</Description>
                </RunAsynchronousCommand>
                <RunAsynchronousCommand>
                    <Order>3</Order>
                    <Path>reg.exe ADD HKLM\SYSTEM\Setup\LabConfig /v BypassSecureBootCheck /t REG_DWORD /d 1 /f</Path>
                    <Description>Windows 11 disable Secure Boot check</Description>
                </RunAsynchronousCommand>
                <RunAsynchronousCommand>
                    <Order>4</Order>
                    <Path>reg.exe ADD HKLM\SYSTEM\Setup\LabConfig /v BypassStorageCheck /t REG_DWORD /d 1 /f</Path>
                    <Description>Windows 11 disable Storage check</Description>
                </RunAsynchronousCommand>
                <RunAsynchronousCommand>
                    <Order>5</Order>
                    <Path>reg.exe ADD HKLM\SYSTEM\Setup\LabConfig /v BypassTPMCheck /t REG_DWORD /d 1 /f</Path>
                    <Description>Windows 11 disable TPM check</Description>
                </RunAsynchronousCommand>
            </RunAsynchronous>
        </component>
    </settings>

    <settings pass="oobeSystem" wasPassProcessed="true">
        <component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
            <AutoLogon>
                <Password>*SENSITIVE*DATA*DELETED*</Password>
                <Enabled>true</Enabled>
                <Username>vboxuser</Username>
            </AutoLogon>

            <UserAccounts>

                <AdministratorPassword>*SENSITIVE*DATA*DELETED*</AdministratorPassword>

                <LocalAccounts>
                    <LocalAccount wcm:action="add">
                        <Name>vboxuser</Name>
                        <DisplayName>vboxuser</DisplayName>
                        <Group>administrators;users</Group>
                        <Password>*SENSITIVE*DATA*DELETED*</Password>
                    </LocalAccount>
                </LocalAccounts>


            </UserAccounts>

            <VisualEffects>
                <FontSmoothing>ClearType</FontSmoothing>
            </VisualEffects>

            <OOBE>
                <ProtectYourPC>3</ProtectYourPC>
                <HideEULAPage>true</HideEULAPage>
                <SkipUserOOBE>true</SkipUserOOBE>
                <SkipMachineOOBE>true</SkipMachineOOBE>
                <!-- Make this (NetworkLocation) default to public and make it configurable -->
                <NetworkLocation>Home</NetworkLocation>
            </OOBE>

            <FirstLogonCommands>
                <SynchronousCommand wcm:action="add">
                    <!-- For which OS versions do we need to do this? -->
                    <Order>1</Order>
                    <Description>Turn Off Network Selection pop-up</Description>
                    <CommandLine>reg.exe add "HKLM\SYSTEM\CurrentControlSet\Control\Network\NewNetworkWindowOff"</CommandLine>
                </SynchronousCommand>
                <SynchronousCommand wcm:action="add">
                    <Order>2</Order>
                    <Description>VirtualBox post guest install steps </Description>
                    <CommandLine>cmd.exe /c A:\VBOXPOST.CMD --vista-or-newer</CommandLine>
                </SynchronousCommand>
            </FirstLogonCommands>

            <TimeZone>Mountain Standard Time</TimeZone>
        </component>

    </settings>
</unattend>